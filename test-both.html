<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Both Features - AI Bot Privacy Guard & Request Logger</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 12px;
      }
      .chat-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        height: 400px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: none;
        z-index: 1000;
      }
      .chat-header {
        background: #667eea;
        color: white;
        padding: 15px;
        border-radius: 8px 8px 0 0;
        font-weight: bold;
      }
      .chat-messages {
        height: 280px;
        overflow-y: auto;
        padding: 15px;
      }
      .chat-input {
        padding: 15px;
        border-top: 1px solid #eee;
      }
      .chat-input input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 8px;
      }
      .chat-input button {
        width: 100%;
        padding: 8px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .message {
        margin-bottom: 10px;
        padding: 8px 12px;
        border-radius: 15px;
        max-width: 80%;
      }
      .bot-message {
        background: #f1f3f4;
        color: #333;
        margin-right: auto;
      }
      .user-message {
        background: #667eea;
        color: white;
        margin-left: auto;
      }
      .chat-toggle {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Test Both Features</h1>
      <p>
        This page tests both AI Bot Privacy Guard and Request Logger
        functionality.
      </p>

      <h2>ü§ñ AI Bot Privacy Guard Test</h2>
      <p>
        Click the chat button (üí¨) in the bottom right corner to test AI bot
        detection.
      </p>
      <p>
        The extension should detect the chat widget and monitor conversations
        for privacy risks.
      </p>

      <button onclick="testBotDetection()" style="background: #28a745">
        üß™ Test Bot Detection
      </button>
      <button onclick="checkExtensionStatus()" style="background: #17a2b8">
        üîç Check Extension Status
      </button>
      <button onclick="createObviousBot()" style="background: #dc3545">
        üö® Create Obvious Bot
      </button>
      <button onclick="testContentScript()" style="background: #6f42c1">
        üî¨ Test Content Script
      </button>
      <button onclick="simulatePrivacyRisk()" style="background: #ffc107">
        üö® Simulate Privacy Risk
      </button>

      <div
        id="botStatus"
        style="
          margin: 10px 0;
          padding: 10px;
          background: #f8f9fa;
          border-radius: 4px;
          display: none;
        "
      >
        <strong>Bot Detection Status:</strong>
        <div id="botStatusContent"></div>
      </div>

      <h2>üìù Request Logger Test</h2>
      <p>
        Click the buttons below to trigger network requests that will be logged:
      </p>

      <button onclick="testFetch()">Test Fetch Request</button>
      <button onclick="testXHR()">Test XHR Request</button>
      <button onclick="testImage()">Test Image Request</button>
      <button onclick="testForm()">Test Form Submission</button>
      <button onclick="testAPI()">Test API Call</button>

      <h2>üìä Console Logs</h2>
      <div id="logs" class="log">
        Check browser console for extension logs...
      </div>

      <h2>üìã Instructions</h2>
      <ol>
        <li>Make sure the Chrome extension is installed and enabled</li>
        <li>Open Chrome DevTools (F12) and go to Console tab</li>
        <li>Click the chat button (üí¨) to test AI bot detection</li>
        <li>Click the test buttons above to trigger network requests</li>
        <li>Check the console for extension logs from both features</li>
        <li>Check your API endpoint for received logs</li>
      </ol>
    </div>

    <!-- Chat Widget (AI Bot) -->
    <button class="chat-toggle" onclick="toggleChat()">üí¨</button>

    <div class="chat-widget" id="chatWidget">
      <div class="chat-header">ü§ñ AI Customer Support</div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">
          Hello! I'm your AI customer support assistant. How can I help you
          today?
        </div>
      </div>
      <div class="chat-input">
        <input
          type="text"
          id="chatInput"
          placeholder="Type your message..."
          onkeypress="handleChatInput(event)"
        />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <script>
      let chatOpen = false
      let messageCount = 0

      // Toggle chat widget
      function toggleChat() {
        const chatWidget = document.getElementById('chatWidget')
        chatOpen = !chatOpen
        chatWidget.style.display = chatOpen ? 'block' : 'none'

        if (chatOpen) {
          addLog('Chat widget opened - AI Bot Privacy Guard should detect this')
        }
      }

      // Handle chat input
      function handleChatInput(event) {
        if (event.key === 'Enter') {
          sendMessage()
        }
      }

      // Send chat message
      function sendMessage() {
        const input = document.getElementById('chatInput')
        const message = input.value.trim()

        if (message) {
          // Add user message
          addMessage(message, 'user')

          // Simulate bot response with privacy risk
          setTimeout(() => {
            const botResponse = generateBotResponse(message)
            addMessage(botResponse, 'bot')
          }, 1000)

          input.value = ''
        }
      }

      // Add message to chat
      function addMessage(content, sender) {
        const messagesDiv = document.getElementById('chatMessages')
        const messageDiv = document.createElement('div')
        messageDiv.className = `message ${sender}-message`
        messageDiv.textContent = content
        messagesDiv.appendChild(messageDiv)
        messagesDiv.scrollTop = messagesDiv.scrollHeight

        messageCount++
        addLog(
          `Message ${messageCount} sent (${sender}): ${content.substring(
            0,
            50
          )}...`
        )
      }

      // Generate bot response (with privacy risks)
      function generateBotResponse(userMessage) {
        const responses = [
          "I'd be happy to help! To better assist you, could you please provide your full name?",
          'Thanks for reaching out! For security purposes, I need to verify your email address.',
          "I understand your concern. To process your request, I'll need your phone number.",
          'Let me help you with that. First, could you confirm your date of birth?',
          "I need some additional information. What's your home address?",
          'To complete this transaction, please provide your credit card number.',
          'For verification purposes, I need your Social Security number.',
          'Could you please share your bank account details?',
        ]

        return responses[Math.floor(Math.random() * responses.length)]
      }

      // Test functions for Request Logger
      function testFetch() {
        fetch('https://jsonplaceholder.typicode.com/posts/1')
          .then((response) => response.json())
          .then((data) => {
            addLog('Fetch request completed successfully')
          })
          .catch((error) => {
            addLog('Fetch request failed: ' + error.message)
          })
      }

      function testXHR() {
        const xhr = new XMLHttpRequest()
        xhr.open('GET', 'https://jsonplaceholder.typicode.com/users/1')
        xhr.onload = function () {
          if (xhr.status === 200) {
            addLog('XHR request completed successfully')
          }
        }
        xhr.onerror = function () {
          addLog('XHR request failed')
        }
        xhr.send()
      }

      function testImage() {
        const img = new Image()
        img.onload = function () {
          addLog('Image request completed successfully')
        }
        img.onerror = function () {
          addLog('Image request failed')
        }
        img.src = 'https://via.placeholder.com/150x150'
      }

      function testForm() {
        const formData = new FormData()
        formData.append('test', 'form_submission')
        formData.append('timestamp', new Date().toISOString())

        fetch('https://httpbin.org/post', {
          method: 'POST',
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            addLog('Form submission completed successfully')
          })
          .catch((error) => {
            addLog('Form submission failed: ' + error.message)
          })
      }

      function testAPI() {
        fetch('https://httpbin.org/get?test=extension&feature=both')
          .then((response) => response.json())
          .then((data) => {
            addLog('API request completed successfully')
          })
          .catch((error) => {
            addLog('API request failed: ' + error.message)
          })
      }

      // Add log to page
      function addLog(message) {
        const logsDiv = document.getElementById('logs')
        const timestamp = new Date().toLocaleTimeString()
        logsDiv.innerHTML += `[${timestamp}] ${message}<br>`
      }

      // Page load event
      window.addEventListener('load', function () {
        addLog('Test page loaded - both extensions should be active')
        addLog('AI Bot Privacy Guard should detect the chat widget')
        addLog('Request Logger should capture network requests')
      })

      // Add some dynamic content to trigger mutation observer
      setTimeout(() => {
        const newDiv = document.createElement('div')
        newDiv.innerHTML =
          '<p>Dynamic content loaded - testing mutation observer</p>'
        document.body.appendChild(newDiv)
        addLog('Dynamic content added to page')
      }, 2000)

      // Test bot detection manually
      function testBotDetection() {
        addLog('üß™ Manually testing bot detection...')

        // Create a test bot element
        const testBot = document.createElement('div')
        testBot.className = 'test-chat-widget'
        testBot.id = 'test-bot'
        testBot.innerHTML = '<p>Test AI Bot</p>'
        testBot.style.cssText =
          'position: fixed; top: 20px; left: 20px; background: white; padding: 20px; border: 2px solid red; z-index: 1000;'

        document.body.appendChild(testBot)
        addLog('‚úÖ Test bot element created - extension should detect this')

        // Remove after 5 seconds
        setTimeout(() => {
          if (testBot.parentElement) {
            testBot.remove()
            addLog('üóëÔ∏è Test bot element removed')
          }
        }, 5000)
      }

      // Create an obvious bot element for testing
      function createObviousBot() {
        addLog('üö® Creating an obvious bot element...')
        const obviousBot = document.createElement('div')
        obviousBot.className = 'test-chat-widget'
        obviousBot.id = 'obvious-bot'
        obviousBot.innerHTML = '<p>Obvious Bot</p>'
        obviousBot.style.cssText =
          'position: fixed; top: 20px; left: 20px; background: white; padding: 20px; border: 2px solid blue; z-index: 1000;'
        document.body.appendChild(obviousBot)
        addLog(
          '‚úÖ Obvious bot element created - should trigger AI Bot Privacy Guard'
        )
      }

      // Check extension status
      function checkExtensionStatus() {
        addLog('üîç Checking extension status...')

        try {
          // Try to send a message to the extension
          if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.sendMessage(
              { action: 'getStatus' },
              function (response) {
                if (chrome.runtime.lastError) {
                  addLog(
                    '‚ùå Extension communication error: ' +
                      chrome.runtime.lastError.message
                  )
                } else if (response) {
                  addLog(
                    '‚úÖ Extension is responding: ' + JSON.stringify(response)
                  )
                  showBotStatus('Extension is working and responding')
                } else {
                  addLog('‚ö†Ô∏è Extension responded but no data received')
                  showBotStatus('Extension responded but no data')
                }
              }
            )
          } else {
            addLog('‚ùå Chrome runtime not available')
            showBotStatus('Chrome runtime not available')
          }
        } catch (error) {
          addLog('‚ùå Error checking extension: ' + error.message)
          showBotStatus('Error: ' + error.message)
        }
      }

      // Test if content script is actually running
      function testContentScript() {
        addLog('üß™ Testing if content script is running...')

        // Check if we can access chrome.runtime
        if (typeof chrome === 'undefined') {
          addLog('‚ùå Chrome API not available')
          return
        }

        if (!chrome.runtime) {
          addLog('‚ùå Chrome runtime not available')
          return
        }

        addLog('‚úÖ Chrome runtime available')

        // Try to get extension ID
        try {
          const extensionId = chrome.runtime.id
          addLog('‚úÖ Extension ID: ' + extensionId)
        } catch (e) {
          addLog('‚ùå Could not get extension ID: ' + e.message)
        }

        // Check if we're in an extension context
        if (chrome.runtime.getManifest) {
          try {
            const manifest = chrome.runtime.getManifest()
            addLog('‚úÖ Extension manifest available: ' + manifest.name)
          } catch (e) {
            addLog('‚ùå Could not get manifest: ' + e.message)
          }
        } else {
          addLog('‚ùå Not in extension context')
        }
      }

      // Simulate a conversation with privacy risks
      function simulatePrivacyRisk() {
        addLog('üö® Simulating privacy risk conversation...')

        // Create a fake bot message asking for personal info
        const botMessage = document.createElement('div')
        botMessage.className = 'message bot-message'
        botMessage.textContent =
          "Hi! I'm an AI assistant. What's your name and phone number?"
        botMessage.style.cssText =
          'background: #f1f3f4; padding: 10px; margin: 10px; border-radius: 15px; max-width: 80%;'

        // Add it to the page
        document.body.appendChild(botMessage)
        addLog('‚úÖ Bot message added: "What\'s your name and phone number?"')
        addLog('üîç AI Bot Privacy Guard should detect this as a privacy risk!')

        // Remove after 10 seconds
        setTimeout(() => {
          if (botMessage.parentElement) {
            botMessage.remove()
            addLog('üóëÔ∏è Bot message removed')
          }
        }, 10000)
      }

      // Show bot status
      function showBotStatus(message) {
        const statusDiv = document.getElementById('botStatus')
        const contentDiv = document.getElementById('botStatusContent')

        contentDiv.textContent = message
        statusDiv.style.display = 'block'

        // Hide after 10 seconds
        setTimeout(() => {
          statusDiv.style.display = 'none'
        }, 10000)
      }
    </script>
  </body>
</html>
